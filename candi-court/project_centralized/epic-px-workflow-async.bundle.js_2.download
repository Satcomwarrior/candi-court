"use strict";(self.webpackChunklootkit_workflow=self.webpackChunklootkit_workflow||[]).push([[565],{565:(e,t,r)=>{r.r(t),r.d(t,{EmbeddedWorkflow:()=>H,IWorkflowStep:()=>o.IWorkflowStep,IWorkflowStyleProps:()=>n.IWorkflowStyleProps,SimpleWorkflowStyle:()=>A,Workflow:()=>V,WorkflowProgress:()=>N,createSteps:()=>a,getWorkflowPattern:()=>S,useGoBackStepNavigation:()=>x,useGoBackStepPath:()=>y,useStepConfig:()=>g,useStepNavigation:()=>T,useStepRouter:()=>b,withStyleContext:()=>D});var n={};r.r(n);var o={};r.r(o);var s=r(47);function a(e){const t=/^[\w-]+$/i;return Object.keys(e).reduce(((r,n)=>{const o=e[n],{pattern:a}=o;return t.test(a)?Object.assign(Object.assign({},r),{[n]:Object.assign(Object.assign({},o),{__$iws:!0,__$iwsi:!0})}):((0,s.logDebugError)(`Invalid pattern "${a}". Only alphanumeric and dash characters are allowed.`),r)}),{})}function i(e){return(null==e?void 0:e.__$iws)&&e.__$iwsi}var l=r(363),c=r.n(l);const u=(0,l.createContext)({updateStepConfig:()=>{},stepStack:[]}),p=u.Provider;var m=r(431);function f(){return(0,l.useContext)(u).stepStack}function g(e){const t=(0,l.useContext)(u).updateStepConfig,r=(0,l.useRef)(!0);return(0,l.useLayoutEffect)((()=>{r.current&&e&&t(e),r.current=!1}),[t,e]),t}var d=r(711),h=r(978);const k=":stepKey";function S(e){return e?`${e}/${k}?`:`${k}?`}function w(e,t,r,n,o){const{goBack:s,replaceStepStack:a}=null!=o?o:{},l=i(r)?r.pattern:void 0;let c=t,u=n?(0,h.queryFromParams)(n):void 0;if(s){const e=t.findIndex((({key:e},t)=>t>0&&e===l));e>=0?(c=t.slice(e+1),u||(u=t[e].search)):c=[]}return a&&(c=[]),{__$irp:!0,pathname:(0,d.generatePath)(e,{stepKey:l}),search:u,state:{stepStack:c}}}var v=r(553);function b(e="generic"){const{path:t}=(0,d.useRouteMatch)(),r=f(),n=(0,l.useCallback)(((e,n,o)=>w(t,r,e,n,o)),[t,r]),o=(0,l.useContext)(u).nextStep,s=(0,l.useCallback)(((e,n)=>o?w(t,r,o,e,n):null),[t,r,o]);return"next"===e?s:n}function y(){var e;const t=null===(e=f()[1])||void 0===e?void 0:e.key,r=b();return(0,l.useMemo)((()=>{if(!t)return;const e={__$iws:!0,__$iwsi:!0,pattern:t,phiFreeTitle:"",Component:v.NoOp};return r(e,void 0,{goBack:!0})}),[t,r])}function x(){const e=y(),t=(0,l.useCallback)((()=>e),[e]),r=(0,h.useRouterFnToNavigate)(t);return e?r:void 0}function E(){var e,t;return null!==(t=null===(e=(0,d.useParams)())||void 0===e?void 0:e.stepKey)&&void 0!==t?t:""}function T(e,t){const{type:r,options:n}="string"==typeof e?{type:e,options:t}:{type:"generic",options:e},{replace:o}=null!=n?n:{},a=b(),i=(0,l.useCallback)(((e,t,r)=>{const n=o||(null==r?void 0:r.replaceStepStack);return a(e,t,Object.assign(Object.assign({},r),{replaceStepStack:n}))}),[a,o]),c=(0,h.useRouterFnToNavigate)(i,n),u=b("next"),p=(0,l.useCallback)(((...[e,t])=>{const r=o||(null==t?void 0:t.replaceStepStack);return u(e,Object.assign(Object.assign({},t),{replaceStepStack:r}))||((0,s.logDebugError)("No next step defined. Predetermined step navigation is only possible from non-final orderedSteps."),{__$irp:!0,pathname:"",state:{stepStack:[]}})}),[u,o]),m=(0,h.useRouterFnToNavigate)(p,n);return"next"===r?m:c}const O=[];var C=r(418),P=r(398);const _=Math.ceil(3),M=9-_,$=(0,l.memo)((function(e){const{index:t,total:r,activeIndex:n,totalToShow:o}=e,s=t===n?"active":t<n?"complete":"incomplete",a=j(n,r,o),i=function(e,t,r){const n=j(e,t,r);return Math.min(t,n+r)-1}(n,r,o);let l=8,u=20*Math.max(0,Math.min(t,i)-a);return"incomplete"===s&&(u+=24),t>i&&(u+=8),t===a-1?l=4:t===a&&0!==a?(l=7,u=4+_):t===i&&i!==r-1?(l=7,u+=M-12):t===i+1?(l=4,u-=4):(t<a||t>i)&&(l=0),c().createElement("rect",{className:`_DiscreteProgressDot _${s}`,x:u,y:4-l/2,rx:l/2,width:"active"===s?32:l,height:l,fill:"incomplete"===s?"gainsboro":"blue"})}));function j(e,t,r){const n=Math.floor((r-1)/2);return Math.max(0,e-Math.max(n,r-(t-e)))}const W=(0,l.memo)((function(e){const{maxThatFit:t}=e,r=t>=0,[n,o]=(0,l.useState)(e);(0,l.useEffect)((()=>{r&&o(void 0)}),[r]);const{total:s,activeIndex:a}=null!=n?n:e,i=r?t:s,u=Math.min(s,10,Math.max(3,i)),p=20*(u-1)+32;return c().createElement("svg",{key:r?"ready":"notReady",className:"_DiscreteProgressDots",width:p,height:8},Array.from({length:s},((e,t)=>c().createElement($,{key:t,index:t,total:s,activeIndex:a,totalToShow:u}))))})),F=(0,l.memo)((function(e){const{workflowLabel:t,currentStepIndex:r,totalSteps:n}=e,o=r+1,s=(0,P.useStringResource)(StringResources.react.clientsdk.WorkflowProgressDiscreteValueText,(()=>[{name:"CURRENTSTEP",value:o.toString()},{name:"TOTALSTEPS",value:n.toString()}]),[o,n]),a=(0,l.useMemo)((()=>(0,P.resolveDisplayStringAsAttribute)("aria-label",t)),[t]),i=(0,l.useMemo)((()=>(0,P.resolveDisplayStringAsAttribute)("aria-valuetext",s)),[s]),[u,p]=(0,l.useState)(-1),m=(0,l.useRef)(null);return(0,l.useLayoutEffect)((()=>{const{current:e}=m;if(null!==e){const t=new ResizeObserver((()=>{const t=e.offsetWidth,r=Math.floor((t-32)/20)+1;p(r)}));return t.observe(e),()=>t.disconnect()}}),[]),n<=1?null:c().createElement("div",Object.assign({ref:m,className:"_DiscreteProgress",role:"progressbar","aria-valuenow":o,"aria-valuemin":1,"aria-valuemax":n},a,i),c().createElement(W,{total:n,activeIndex:r,maxThatFit:u}))})),R=(0,l.memo)((function(e){const{workflowLabel:t,percentComplete:r}=e,n=Math.floor(r),o=(0,P.useStringResource)(StringResources.react.clientsdk.WorkflowProgressAmbiguousValueText,(()=>[{name:"PERCENTAGE",value:n.toString()}]),[n]),s=(0,l.useMemo)((()=>(0,P.resolveDisplayStringAsAttribute)("aria-label",t)),[t]),a=(0,l.useMemo)((()=>(0,P.resolveDisplayStringAsAttribute)("aria-valuetext",o)),[o]);return c().createElement("div",Object.assign({className:"_AmbiguousProgress",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100},s,a),c().createElement(v.Text,{cssClasses:"progressText"},o),c().createElement("svg",{className:"progressBar",width:"100%",height:8},c().createElement("rect",{className:"progressIndicator _incomplete",width:"100%",height:"100%",rx:4,fill:"gainsboro"}),c().createElement("rect",{className:"progressIndicator _complete",width:`${n}%`,height:"100%",rx:4,fill:"blue"})))})),N=(0,l.memo)((function(e){const{type:t}=e;switch(t){case"ambiguous":return c().createElement(R,Object.assign({},e));case"discrete":return c().createElement(F,Object.assign({},e));default:return null}})),B={};var L=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r};function D(e){const t=function(e){return(0,l.memo)((function(t){const{context:r,step:n}=t,o=L(t,["context","step"]),{workflowKey:s,phiFreeTitle:a,orderedSteps:i,percentComplete:u,showBackLink:f,syncStepTitle:g}=r,[k,S]=function(e,t){const[r,n]=(0,l.useState)(e.phiFreeTitle),[o,s]=(0,l.useState)(e.hideBack),[a,i]=(0,l.useState)(e.hideProgress);(0,l.useLayoutEffect)((()=>null==t?void 0:t(r)),[t,r]);const c=(0,l.useCallback)((r=>{const{phiFreeTitle:o,hideBack:a,hideProgress:l}=r;s(a||e.hideBack),i(l||e.hideProgress);const c=o&&!(0,m.isNullOrWhiteSpace)(o)?o:e.phiFreeTitle;n(c),null==t||t(c)}),[e,t]);return[(0,l.useMemo)((()=>({phiFreeTitle:r,hideBack:o,hideProgress:a})),[r,o,a]),c]}(n,g),{phiFreeTitle:w,hideBack:v,hideProgress:b}=k,y=i&&i.indexOf(n)>=0?i[i.indexOf(n)+1]:void 0,x=function(){var e;const t=E(),{pathname:r,search:n,state:o}=(0,d.useLocation)(),s=null==o?void 0:o.stepStack,a=(0,l.useRef)(s),i=null!==(e=null!=s?s:a.current)&&void 0!==e?e:O;return a.current=i,(0,l.useMemo)((()=>t?[{key:t,pathname:r,search:n},...i]:i),[t,r,n,i])}(),T=(0,l.useMemo)((()=>({updateStepConfig:S,nextStep:y,stepStack:x})),[S,y,x]),C=function(e){const{workflowKey:t,step:r,orderedSteps:n,percentComplete:o,hideProgress:s}=e,a=(0,l.useMemo)((()=>{if(!s){if("number"==typeof o)return{type:"ambiguous",percentComplete:o};if(n){const e=n.indexOf(r);if(e>=0)return{type:"discrete",currentStepIndex:e,totalSteps:n.length}}}return{type:"none"}}),[s,o,n,r]),i=B[t];B[t]=a;const[c,u]=(0,l.useState)("none"!==a.type&&i&&a.type===i.type);return(0,l.useEffect)((()=>u(!1)),[]),c?i:a}({workflowKey:s,step:n,orderedSteps:i,percentComplete:u,hideProgress:b}),{Component:P}=n,_=function(){const{search:e}=(0,d.useLocation)();return(0,l.useMemo)((()=>(0,h.paramsFromQuery)(e)),[e])}();return c().createElement(p,{value:T},c().createElement(e,Object.assign({},o,{step:n,orderedSteps:i,phiFreeWorkflowTitle:a,phiFreeStepTitle:w,showBackLink:!v&&f,progress:C}),c().createElement(P,Object.assign({},_))))}))}(e);return(0,l.memo)((function(e){const{context:r}=e,n=E();if(!(null==(o=r)?void 0:o.__$wsc)||!o.__$wsci)return(0,s.logDebugError)("Missing required style context"),null;var o;const{steps:a,orderedSteps:l}=r,u=function(e,t){return Object.values(e).find((e=>i(e)&&e.pattern===t))}(a,n);return u?(l&&new Set(l).size!==l.length&&(0,s.logDebugError)("orderedSteps cannot have duplicates steps"),c().createElement(t,Object.assign({},e,{context:r,step:u}))):((0,s.logDebugError)(`Workflow Error: unknown step: ${n}`),null)}))}const I=(0,l.memo)((function(){const e=StringResources.react.clientsdk,t=y();return t?c().createElement(v.InternalLink,{cssClasses:"_GoBackStepLink",path:t,accessibleDescription:e.WorkflowBack},c().createElement(v.Icon,{path:"library.svg#back",size:10}),c().createElement(v.TextFragment,null,e.WorkflowBack)):null})),A=D((0,l.memo)((function(e){const{phiFreeWorkflowTitle:t,phiFreeStepTitle:r,showBackLink:n,progress:o,children:s}=e;(0,h.useMobileWebViewTitle)(t);const a=x();return(0,h.useMobileBackButtonHandler)(a,0),c().createElement(v.Segment,{cssClasses:"_SimpleWorkflowStyle"},c().createElement(v.Segment,{cssClasses:"titleProgressGroup"},c().createElement(v.Segment,{cssClasses:"workflowTitleGroup"},n?c().createElement(I,null):null,c().createElement(v.PageHeading,{cssClasses:"workflowTitle",headingLevel:"1"},t)),c().createElement(N,Object.assign({workflowLabel:t},o))),c().createElement(v.PageHeading,{cssClasses:"stepTitle",headingLevel:"2"},r),s)}))),K=e=>c().createElement(A,{context:e});function G(e){const{steps:t,workflowKey:r,phiFreeTitle:n,orderedSteps:o,percentComplete:s,showBackLink:a,syncStepTitle:i,children:c=K}=e,u=(0,l.useMemo)((()=>({__$wsc:!0,__$wsci:!0,steps:t,workflowKey:r,phiFreeTitle:n,orderedSteps:o,percentComplete:s,showBackLink:a,syncStepTitle:i})),[t,r,n,o,s,a,i]);return(0,l.useMemo)((()=>c(u)),[c,u])}const H=(0,l.memo)((function(e){const{initialStep:t,initialParams:r,phiFreeTitle:n,workflowKey:o}=e,s=(0,d.useHistory)(),a=(0,h.useNavigationContext)(),{pathname:i}=(0,d.useLocation)(),u=S(s.createHref({pathname:i})),[{history:p,navigate:f}]=(0,l.useState)((()=>{const{pathname:e,search:n}=w(u,[],t,r),o=`${e}${n?`?${n}`:""}`;return(0,h.createCustomRoutingContext)("memory",u,{history:s,navigate:a},{initialEntries:[o]})})),g=(0,l.useRef)(!1),k=(0,l.useCallback)((e=>{e&&(g.current&&(0,C.tryToFocusOn)(e),g.current=!0)}),[]),[v,b]=(0,l.useState)(""),y=(0,l.useMemo)((()=>{const e=(0,P.resolveDisplayString)(n,P.EncodingTypes.None);return(0,m.isNullOrWhiteSpace)(v)?e:`${e} - ${(0,P.resolveDisplayString)(v,P.EncodingTypes.None)}`}),[n,v]),[x]=(0,l.useState)((()=>Symbol())),E=G(Object.assign(Object.assign({},e),{workflowKey:null!=o?o:x,syncStepTitle:b}));return c().createElement(d.Router,{history:p},c().createElement(h.NavigationProvider,{value:f},c().createElement(d.Route,{exact:!0,path:u},(e=>{const{location:t}=e,{pathname:r,search:n}=t;return c().createElement("section",{key:`${r}${n}`,ref:k,tabIndex:g.current?-1:void 0,"aria-label":y,onBlur:z},E)}))))})),z=e=>e.target.removeAttribute("tabIndex"),V=(0,l.memo)((function(e){var t;const{initialStep:r,initialParams:n,workflowKey:o}=e,a=E(),{path:i=""}=null!==(t=(0,d.useRouteMatch)())&&void 0!==t?t:{},c=i.endsWith(S("")),u=T({replace:!0}),p=!a;(0,l.useLayoutEffect)((()=>{c&&p&&u(r,n)}),[c,p,u,r,n]);const m=G(Object.assign(Object.assign({},e),{workflowKey:null!=o?o:i}));return c?p?null:m:((0,s.logDebugError)('Workflow must be rendered inside a route with a valid workflow pattern (see "getWorkflowPattern").'),null)}))}}]);